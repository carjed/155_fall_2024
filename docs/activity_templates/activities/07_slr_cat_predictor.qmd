---
title: "Simple linear regression: categorical predictor"
subtitle: "Notes and in-class exercises"
format: 
  html:
    embed-resources: true
    toc: true
eval: false # change this to "true" if you want to render a complete .qmd    
---

# Notes

- Download the `.qmd` file for this activity [here](../activity_templates/07_slr_cat_predictor.qmd).
- **File organization:** Save this file in the "Activities" subfolder of your "STAT155" folder.
- Open the `qmd` file in RStudio, and use it to type your answers/code to the exercises and reflection on the in-class activities. 

## Learning goals

By the end of this lesson, you should be able to:

- Write a **model formula** for a simple linear regression model with a categorical predictor using **indicator variables**
- Interpret the **intercept** and **slope** coefficients in a simple linear regression model with a categorical predictor

## Readings and videos

Choose either the reading or the videos to go through **before** class.

- Reading: Section 3.9 in the [STAT 155 Notes](https://mac-stat.github.io/Stat155Notes/) only up through section 3.9.1 Indicator Variables
- Videos:
    - [Simple linear regression: categorical predictor](https://youtu.be/QPpp6Kpk2To) ([slides](https://drive.google.com/file/d/1fbSJW4DhVWxR8rykowPUoAZ6WfzuZ857/view?usp=sharing))
    - [R Code for Categorical Predictors](https://voicethread.com/share/14980390/)

<!-- This section is for any mini-lecture, review material, material to motivate today's lesson, more guided / structured examples than the exercises section below. -->

# Exercises

**Context:** Today we'll explore data on thousands of diamonds to understand how physical characteristics relate to price. Read in the data below.

```{r warning=FALSE, message=FALSE}
# Load packages and import data
library(ggplot2)
library(dplyr)

data(diamonds)

# A little bit of data wrangling code - let's not focus on this for now
diamonds <- diamonds %>% 
    mutate(
        cut = factor(cut, ordered = FALSE),
        color = factor(color, ordered = FALSE),
        clarity = factor(clarity, ordered = FALSE)
    )
```

For the first several exercises, our focus will be on the relationship between diamond price and cut.

## Exercise 1: Get to know the data

Write R code to answer the following:

- How many cases and variables do we have? What does a case represent?
- What do the first few rows of the data look like?
- Construct and interpret two different visualizations of the `price` variable.
- Construct and interpret a visualization of the `cut` variable.



## Exercise 2: Visualizations

Start by visualizing this relationship of interest, that between `price` and `cut`.

a. The appropriate plot depends upon the type of variables we're plotting. When exploring the relationship between a quantitative response (ridership) and a quantitative predictor (temperature), a scatterplot was an effective choice. After running the code below, explain why a scatterplot is not effective for exploring the relationship between ridership and our *categorical* `cut` predictor.

```{r}
# Try a scatterplot
ggplot(diamonds, aes(y = price, x = cut)) + 
    geom_point()
```

b. Separately run each chunk below, with two plots. Comment (`#`) on what changes in the code / output.

```{r}
# Univariate boxplot
ggplot(diamonds, aes(y = price)) + 
    geom_boxplot()
```

```{r}
# ???
ggplot(diamonds, aes(y = price, x = cut)) + 
    geom_boxplot()
```

```{r}
# Univariate density plot
ggplot(diamonds, aes(x = price)) + 
    geom_density()
```

```{r}
# ???
ggplot(diamonds, aes(x = price, color = cut)) + 
    geom_density()
```

```{r}
# Univariate histogram
ggplot(diamonds, aes(x = price)) + 
    geom_histogram()
```

```{r}
# ???
ggplot(diamonds, aes(x = price)) + 
    geom_histogram() + 
    facet_wrap(~ cut)
```

c. Do you notice anything interesting about the relationship between price and cut? What do you think might be happening here?



## Exercise 3: Numerical summaries

Let's follow up our plots with some numerical summaries.

a. To warm up, first calculate the mean `price` across all diamonds.

```{r eval=FALSE}
# HINT CODE: don't change this
diamonds %>% 
    ___(mean(___))
```

```{r}
# Your solution

```

b. To summarize the trends we observed in the grouped plots above, we can calculate the mean `price` for each type of `cut`. This requires the inclusion of the `group_by()` function:

```{r eval=FALSE}
# HINT CODE
# Calculate mean price by cut
diamonds %>% 
    group_by(cut) %>% 
    ___(mean(___))
```

```{r}
# Your solution

``` 

c. Examine the group mean measurements, and make sure that you can match these numbers up with what you see in the plots.



## Exercise 4: Modeling trend

The plots and mean calculations provide *some* insight into the relationship between `price` and `cut`. Next, let's *model* the trend in this relationship. After examining the summary table below, complete the model formula:

\

E[price | cut] = ___ +/- ___ cutGood +/- ___ cutVery Good +/- ___ cutPremium +/- ___ cutIdeal

\   


```{r}
# Construct the model
diamond_mod <- lm(price ~ cut, data = diamonds)

# Summarize the model
coef(summary(diamond_mod))
```



---

**PAUSE: Categorical predictors**

Notice that our `cut` variable shows up as 4 different **indicator variables** in our model. An indicator variable numerically indicates if a categorical variable is at a particular level:

- cutGood = 1 if the diamond is of Good cut
- cutGood = 0 otherwise (any other value of cut (Fair, Very Good, Premium, Ideal))

\

NOTE: We see 4 indicator variables (for Good, Very Good, Premium, and Ideal), but we do not see `cutFair` in the model output. This is because `Fair` is the **reference level** of the `cut` variable (it's first alphabetically). You'll see below that it is, indeed, still in the model. You'll also see why the term "reference level" makes sense!
  
---



## Exercise 5: Making sense of the model

Recall our model:  E[price | cut] = 4358.7578 - 429.8933 cutGood - 376.9979 cutVery Good + 225.4999 cutPremium - 901.2158 cutIdeal

a. Use the model formula to calculate the expected/typical price for diamonds of *Good* cut.

b. Similarly, calculate the expected/typical price for diamonds of *Fair* cut.

c. Re-examine these 2 calculations. Where have you seen these numbers before?!


## Exercise 6: Interpreting coefficients

Recall that our model formula is *not a formula for a line*. Thus we can't interpret the coefficients as "slopes" as we have before. Taking this into account and reflecting upon your calculations above...   

a. Interpret the intercept coefficient (`4358.7578`) in terms of the data context. *Make sure to use non-causal language, include units, and talk about averages rather than individual cases.*

b. Interpret the `cutGood` and `cutVery Good` coefficients (`-429.8933` and `-376.9979`) in terms of the data context. Hint: where did you use these value in the prediction calculations above?



## Exercise 7: Modeling choices (CHALLENGE)

Why do we fit this model in this way (using 4 indicator variables `cutGood`,  `cutVery Good`, `cutPremium`, `cutIdeal`)? Instead, suppose that we created a single variable `cutCat` that gave each category a numerical value: 0 for Fair, 1 for Good, 2 for Very Good, 3 for Premium, and 4 for Ideal.

How would this change things? What are the pros and cons of each approach?



## Reflection

Through the exercises above, you learned how to build and interpret models that incorporate a categorical predictor variable. For the benefit of your future self, summarize how one can interpret the coefficients for a categorical predictor.

> **Response:** Put your response here.



## Render your work

- Click the "Render" button in the menu bar for this pane (blue arrow pointing right). This will create an HTML file containing all of the directions, code, and responses from this activity. A preview of the HTML will appear in the browser.
- Scroll through and inspect the document to check that your work translated to the HTML format correctly.
- Close the browser tab.
- Go to the "Background Jobs" pane in RStudio and click the Stop button to end the rendering process.
- Navigate to your "Activities" subfolder within your "STAT155" folder and locate the HTML file. You can open it again in your browser to double check.



# Additional Practice

## Exercise 8: Diamond color

Consider modeling `price` by `color`.

- Before creating a visualization that shows the relationship between price and color, write down what you expect the plot to look like. Then construct and interpret an apporpriate plot.
- Compute the average price for each color.
- Fit an appropriate linear model with `lm()` and display a short summary of the model.
- Write out the model formula from the above summary.
- Which color is the reference level? How can you tell from the model summary?
- Interpret the intercept and two other coefficients from the model in terms of the data context.



## Exercise 9: Diamond clarity

If you want more practice, repeat the steps from Exercise 8 for the `clarity` variable.



<br><br><br><br><br><br>

[Solutions](../solutions/07_slr_cat_predictor.qmd)
